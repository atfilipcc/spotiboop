{"ast":null,"code":"import _slicedToArray from\"/Users/filip.cordas/Documents/Projects/web-api-auth-examples/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable no-unused-vars */import React,{useState,useContext}from'react';import Spotify from'spotify-web-api-js';import{ContextUser}from'../components/UserContext';var spotifyWebApi=new Spotify();var TopList=function TopList(_ref){var getRefreshToken=_ref.getRefreshToken;var _useContext=useContext(ContextUser),user=_useContext.user,setUser=_useContext.setUser;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),topTracks=_useState2[0],setTopTracks=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),isPlaying=_useState4[0],setPlaying=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var getTopList=function getTopList(period){spotifyWebApi.setAccessToken(user.access_token);spotifyWebApi.getMyTopTracks({limit:30,time_range:period}).then(function(res){console.log(res);setTopTracks(Object.values(res)[0]);}).catch(function(err){if(err.status===401){getRefreshToken();setMessageHelper('Please try again.');}});};var playSong=function playSong(e){var audio=e.target.nextSibling.nextSibling;audio.volume=0.1;if(audio.paused){audio.play();setPlaying(audio);}else{audio.pause();setPlaying([]);}};var addToPlayList=function addToPlayList(){var tracks=topTracks.map(function(track){return track.uri;});spotifyWebApi.createPlaylist(user.id,{name:'Your Top Tracks',public:true,collaborative:false,description:'Your most listened to songs.'},function(err,res){if(err)return setError({error:err});if(res.id)spotifyWebApi.addTracksToPlaylist(res.id,tracks).catch(function(err){return console.log(err.response);});});};var disableButton=function disableButton(e){var buttons=document.getElementsByClassName('TopList__buttons--button');for(var i=0;i<buttons.length;i++){buttons[i].disabled=false;}e.target.disabled=true;};var setMessageHelper=function setMessageHelper(msg){setMessage({message:msg});setTimeout(function(){setMessage('');},5000);};var renderDynamicButtons=function renderDynamicButtons(period){return user.access_token&&/*#__PURE__*/React.createElement(\"button\",{id:period,className:\"TopList__buttons--button\",onClick:function onClick(e){getTopList(period);disableButton(e);}},period.replace(period[0],period[0].toUpperCase()).replace('_',' '));};return/*#__PURE__*/React.createElement(\"div\",{className:\"TopList\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"TopList__title\"},\"Your Top Tracks\"),!user.access_token&&/*#__PURE__*/React.createElement(\"p\",{className:\"message\"},\"Please log in to use this functionality.\"),/*#__PURE__*/React.createElement(\"section\",{className:\"TopList__buttons\"},renderDynamicButtons('long_term'),renderDynamicButtons('medium_term'),renderDynamicButtons('short_term')),topTracks.length>0&&/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){// addToPlayList()\nsetMessageHelper('Playlist created!');}},\"Create playlist\"),error&&/*#__PURE__*/React.createElement(\"p\",{className:\"message\"},error.error),message&&/*#__PURE__*/React.createElement(\"p\",{className:\"message\"},message.message),/*#__PURE__*/React.createElement(\"ul\",{className:\"TopList__list\"},topTracks&&topTracks.map(function(item,index){return/*#__PURE__*/React.createElement(\"article\",{key:\"\".concat(item.name,\" \").concat(item.id),className:\"TopList__song--wrapper\"},item.preview_url!==null&&/*#__PURE__*/React.createElement(\"div\",{className:\"TopList__playpause--wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"playpause \".concat(item.name)},/*#__PURE__*/React.createElement(\"input\",{onClick:function onClick(e){return playSong(e);},type:\"checkbox\",defaultChecked:true,value:\"None\",id:\"playpause \".concat(item.name),name:\"check\"}),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"playpause \".concat(item.name),tabIndex:\"1\"}),/*#__PURE__*/React.createElement(\"audio\",{loop:true,volume:\"0.1\",className:\"audio_\".concat(item.name),key:\"playback \".concat(item.name),src:item.preview_url}))),/*#__PURE__*/React.createElement(\"div\",{className:\"TopList__content\"},/*#__PURE__*/React.createElement(\"li\",{key:item.name,className:\"TopList__song\"},\"\".concat(index+1,\" - \").concat(item.artists[0].name,\" - \").concat(item.name))),/*#__PURE__*/React.createElement(\"img\",{className:\"TopList__image\",alt:item.name,src:item.album.images[1].url}));})));};export default TopList;","map":{"version":3,"sources":["/Users/filip.cordas/Documents/Projects/web-api-auth-examples/client/src/components/TopList.js"],"names":["React","useState","useContext","Spotify","ContextUser","spotifyWebApi","TopList","getRefreshToken","user","setUser","topTracks","setTopTracks","isPlaying","setPlaying","error","setError","message","setMessage","getTopList","period","setAccessToken","access_token","getMyTopTracks","limit","time_range","then","res","console","log","Object","values","catch","err","status","setMessageHelper","playSong","e","audio","target","nextSibling","volume","paused","play","pause","addToPlayList","tracks","map","track","uri","createPlaylist","id","name","public","collaborative","description","addTracksToPlaylist","response","disableButton","buttons","document","getElementsByClassName","i","length","disabled","msg","setTimeout","renderDynamicButtons","replace","toUpperCase","item","index","preview_url","artists","album","images","url"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\nimport React, { useState, useContext } from 'react';\nimport Spotify from 'spotify-web-api-js';\nimport { ContextUser } from '../components/UserContext';\n\nconst spotifyWebApi = new Spotify();\n\nconst TopList = ({ getRefreshToken }) => {\n\tconst { user, setUser } = useContext(ContextUser);\n\tconst [topTracks, setTopTracks] = useState([]);\n\tconst [isPlaying, setPlaying] = useState([]);\n  const [error, setError] = useState({});\n  const [message, setMessage] = useState('');\n\n  const getTopList = (period) => {\n\t\tspotifyWebApi.setAccessToken(user.access_token);\n\t\tspotifyWebApi.getMyTopTracks({limit: 30, time_range: period }).then(res => {\n\t\t\tconsole.log(res);\n\t\t\tsetTopTracks(Object.values(res)[0]);\n    }).catch(err => {\n      if (err.status === 401) {\n        getRefreshToken();\n        setMessageHelper('Please try again.')\n    }\n  })}\n\n  const playSong = e => {\n\t\tconst audio = e.target.nextSibling.nextSibling;\n\t\taudio.volume = 0.1;\n\t\tif (audio.paused) {\n\t\t\taudio.play();\n\t\t\tsetPlaying(audio);\n\t\t} else {\n\t\t\taudio.pause();\n\t\t\tsetPlaying([]);\n\t\t}\n\t}\n\n\tconst addToPlayList = () => {\n\t\tconst tracks = topTracks.map(track => track.uri);\n\t\tspotifyWebApi.createPlaylist(\n\t\t\tuser.id,\n\t\t\t{\n\t\t\t\tname: 'Your Top Tracks',\n\t\t\t\tpublic: true,\n\t\t\t\tcollaborative: false,\n\t\t\t\tdescription: 'Your most listened to songs.',\n\t\t\t},\n\t\t\t(err, res) => {\n\t\t\t\tif (err) return setError({error: err});\n        if (res.id) spotifyWebApi.addTracksToPlaylist(res.id, tracks)\n        .catch(err => console.log(err.response))\n      }\n\t\t);\n\t}\n\n\tconst disableButton = e => {\n\t\tconst buttons = document.getElementsByClassName('TopList__buttons--button');\n\t\tfor (let i = 0; i < buttons.length; i++) buttons[i].disabled = false;\n\t\te.target.disabled = true;\n  };\n\n  const setMessageHelper = (msg) => {\n    setMessage({message: msg})\n    setTimeout(() => {\n      setMessage('')\n    }, 5000);\n  }\n\n\tconst renderDynamicButtons = period =>\n\t\tuser.access_token && (\n\t\t\t<button\n\t\t\t\tid={period}\n\t\t\t\tclassName='TopList__buttons--button'\n\t\t\t\tonClick={e => {\n\t\t\t\t\tgetTopList(period);\n\t\t\t\t\tdisableButton(e);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{(period.replace(period[0], period[0].toUpperCase()).replace('_', ' '))}\n\t\t\t</button>\n\t\t);\n\n\treturn (\n\t\t<div className='TopList'>\n\t\t\t<h1 className='TopList__title'>Your Top Tracks</h1>\n\n\t\t\t{!user.access_token && (\n\t\t\t\t<p className='message'>Please log in to use this functionality.</p>\n\t\t\t)}\n\t\t\t<section className='TopList__buttons'>\n\t\t\t\t{renderDynamicButtons('long_term')}\n\t\t\t\t{renderDynamicButtons('medium_term')}\n\t\t\t\t{renderDynamicButtons('short_term')}\n\t\t\t</section>\n\t\t\t{topTracks.length > 0 && (\n\t\t\t\t<button onClick={() => {\n          // addToPlayList()\n          setMessageHelper('Playlist created!')\n          }}>Create playlist</button>\n\t\t\t)}\n      {error && <p className=\"message\">{error.error}</p>}\n      {message && <p className=\"message\">{message.message}</p>}\n\t\t\t<ul className='TopList__list'>\n\t\t\t\t{topTracks &&\n\t\t\t\t\ttopTracks.map((item, index) => (\n\t\t\t\t\t\t<article key={`${item.name} ${item.id}`} className='TopList__song--wrapper'>\n            {item.preview_url !== null &&\n\t\t\t\t\t\t\t<div className='TopList__playpause--wrapper'>\n\t\t\t\t\t\t\t\t<div className={`playpause ${item.name}`}>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tonClick={e => playSong(e)}\n\t\t\t\t\t\t\t\t\t\ttype='checkbox'\n\t\t\t\t\t\t\t\t\t\tdefaultChecked={true}\n\t\t\t\t\t\t\t\t\t\tvalue='None'\n\t\t\t\t\t\t\t\t\t\tid={`playpause ${item.name}`}\n\t\t\t\t\t\t\t\t\t\tname='check'\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\t\t\thtmlFor={`playpause ${item.name}`}\n\t\t\t\t\t\t\t\t\t\ttabIndex='1'\n\t\t\t\t\t\t\t\t\t></label>\n\t\t\t\t\t\t\t\t\t<audio\n\t\t\t\t\t\t\t\t\t\tloop\n\t\t\t\t\t\t\t\t\t\tvolume='0.1'\n\t\t\t\t\t\t\t\t\t\tclassName={`audio_${item.name}`}\n\t\t\t\t\t\t\t\t\t\tkey={`playback ${item.name}`}\n\t\t\t\t\t\t\t\t\t\tsrc={item.preview_url}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>}\n\t\t\t\t\t\t\t<div className='TopList__content'>\n\t\t\t\t\t\t\t\t<li key={item.name} className='TopList__song'>{`${\n\t\t\t\t\t\t\t\t\tindex + 1\n\t\t\t\t\t\t\t\t} - ${item.artists[0].name} - ${item.name}`}</li>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tclassName='TopList__image'\n                alt={item.name}\n\t\t\t\t\t\t\t\tsrc={item.album.images[1].url}\n\t\t\t\t\t\t\t></img>\n\t\t\t\t\t\t</article>\n\t\t\t\t\t))}\n\t\t\t</ul>\n\t\t</div>\n\t);\n};\n\nexport default TopList;\n"]},"metadata":{},"sourceType":"module"}