{"ast":null,"code":"import _objectSpread from\"/Users/filip.cordas/Documents/Projects/web-api-auth-examples/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/filip.cordas/Documents/Projects/web-api-auth-examples/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useMemo,useEffect}from'react';import{BrowserRouter as Router,Route,Switch}from'react-router-dom';import App from'../components/App';import Layout from'../components/Layout';import About from'../components/About';import Current from'../components/Current';import TopList from'../components/TopList';import Sorter from'../components/Sorter';import{ContextUser}from'../components/UserContext';import qs from'query-string';import axios from'axios';var now=new Date();var AppRouter=function AppRouter(){var loggedOutState={access_token:'',refresh_token:'',name:'',id:'',expiry:''};var _useState=useState(loggedOutState),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var value=useMemo(function(){return{user:user,setUser:setUser};},[user,setUser]);useEffect(function(){var tokens=qs.parse(window.location.search);if(tokens.access_token&&!user.name.length){axios.get('https://api.spotify.com/v1/me',{headers:{Authorization:'Bearer '+tokens.access_token}}).then(function(res){console.log(res);setUser({access_token:tokens.access_token,refresh_token:tokens.refresh_token,name:res.data.display_name,id:res.data.id,expiry:now.getTime()});});}},[user.name.length]);useEffect(function(){var token=localStorage.getItem('userToken');var userToken=JSON.parse(token);setUser(userToken);},[]);useEffect(function(){var json=JSON.stringify(user);localStorage.setItem('userToken',json);},[user]);var logOutUser=function logOutUser(props){localStorage.removeItem('userToken');setUser(loggedOutState);};var getRefreshToken=function getRefreshToken(){axios.get(\"/refresh_token?refresh_token=\".concat(user.refresh_token)).then(function(res){return setUser(_objectSpread(_objectSpread({},user),{},{access_token:res.data.access_token}));});};return/*#__PURE__*/React.createElement(ContextUser.Provider,{value:value},/*#__PURE__*/React.createElement(Router,null,/*#__PURE__*/React.createElement(Layout,null,/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{path:\"/\",exact:true},/*#__PURE__*/React.createElement(App,{logOutUser:logOutUser})),/*#__PURE__*/React.createElement(Route,{path:\"/callback\",exact:true,component:App}),/*#__PURE__*/React.createElement(Route,{path:\"/about\",component:About}),/*#__PURE__*/React.createElement(Route,{path:\"/current\",component:Current}),/*#__PURE__*/React.createElement(Route,{path:\"/toplist\"},/*#__PURE__*/React.createElement(TopList,{getRefreshToken:getRefreshToken,logOutUser:logOutUser})),/*#__PURE__*/React.createElement(Route,{path:\"/sorter\"},/*#__PURE__*/React.createElement(Sorter,{getRefreshToken:getRefreshToken,logOutUser:logOutUser})))))));};export default AppRouter;","map":{"version":3,"sources":["/Users/filip.cordas/Documents/Projects/web-api-auth-examples/client/src/router/router.js"],"names":["React","useState","useMemo","useEffect","BrowserRouter","Router","Route","Switch","App","Layout","About","Current","TopList","Sorter","ContextUser","qs","axios","now","Date","AppRouter","loggedOutState","access_token","refresh_token","name","id","expiry","user","setUser","value","tokens","parse","window","location","search","length","get","headers","Authorization","then","res","console","log","data","display_name","getTime","token","localStorage","getItem","userToken","JSON","json","stringify","setItem","logOutUser","props","removeItem","getRefreshToken"],"mappings":"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","sourcesContent":["import React, { useState, useMemo, useEffect } from 'react';\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom';\nimport App from '../components/App';\nimport Layout from '../components/Layout';\nimport About from '../components/About';\nimport Current from '../components/Current';\nimport TopList from '../components/TopList';\nimport Sorter from '../components/Sorter';\nimport { ContextUser } from '../components/UserContext';\nimport qs from 'query-string';\nimport axios from 'axios';\nconst now = new Date();\n\nconst AppRouter = () => {\n  const loggedOutState = {\n      access_token: '',\n      refresh_token: '',\n      name: '',\n      id: '',\n      expiry: ''\n    }\n\tconst [user, setUser] = useState(loggedOutState);\n  const value = useMemo(() => ({ user, setUser }), [user, setUser]);\n\n\tuseEffect(() => {\n\t\tconst tokens = qs.parse(window.location.search);\n\t\tif (tokens.access_token && !user.name.length) {\n\t\t\taxios\n\t\t\t\t.get('https://api.spotify.com/v1/me', {\n\t\t\t\t\theaders: { Authorization: 'Bearer ' + tokens.access_token },\n\t\t\t\t})\n\t\t\t\t.then(res => {\n          console.log(res)\n\t\t\t\t\tsetUser({\n\t\t\t\t\t\taccess_token: tokens.access_token,\n\t\t\t\t\t\trefresh_token: tokens.refresh_token,\n\t\t\t\t\t\tname: res.data.display_name,\n\t\t\t\t\t\tid: res.data.id,\n\t\t\t\t\t\texpiry: now.getTime(),\n\t\t\t\t\t})\n\t\t\t\t})\n    }\n\t}, [user.name.length]);\n\n\tuseEffect(() => {\n    const token = localStorage.getItem('userToken');\n    const userToken = JSON.parse(token);\n    setUser(userToken);\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst json = JSON.stringify(user);\n    localStorage.setItem('userToken', json);\n  }, [user]);\n\n\tconst logOutUser = (props) => {\n\t\tlocalStorage.removeItem('userToken');\n    setUser(loggedOutState);\n  };\n\n  const getRefreshToken = () => {\n    axios.get(`/refresh_token?refresh_token=${user.refresh_token}`)\n      .then(res => setUser({...user, access_token: res.data.access_token}))\n  }\n\n\treturn (\n\t\t<ContextUser.Provider value={value}>\n\t\t\t<Router>\n\t\t\t\t<Layout>\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Switch>\n\t\t\t\t\t\t\t<Route path='/' exact>\n\t\t\t\t\t\t\t\t<App logOutUser={logOutUser} />\n\t\t\t\t\t\t\t</Route>\n\t\t\t\t\t\t\t<Route path='/callback' exact component={App} />\n\t\t\t\t\t\t\t<Route path='/about' component={About} />\n\t\t\t\t\t\t\t<Route path='/current' component={Current} />\n\t\t\t\t\t\t\t<Route path='/toplist' >\n                <TopList getRefreshToken={getRefreshToken} logOutUser={logOutUser} />\n              </Route>\n              <Route path='/sorter' >\n                <Sorter getRefreshToken={getRefreshToken} logOutUser={logOutUser} />\n              </Route>\n\t\t\t\t\t\t</Switch>\n\t\t\t\t\t</>\n\t\t\t\t</Layout>\n\t\t\t</Router>\n\t\t</ContextUser.Provider>\n\t);\n};\n\nexport default AppRouter;\n"]},"metadata":{},"sourceType":"module"}